(function(){function e(){crudMS.masterValue=$("#dd").datebox("getValue");var e=[];e.push({name:"depotId",value:crudMS.depotId}),e.push({name:"carryoutDate",value:crudMS.masterValue});var t=abp.utils.buildQueryString(e);$("#dg").datagrid({url:"WhAffairs/GridData"+t}),crudMS.selectRow()}function t(){var e=$("#fromDate").datebox("getValue");return""==e?void abp.notify.error("请先设置来源日期!"):crudMS.masterValue<e?void abp.notify.error("任务执行日期必须大于来源日期!"):void abp.message.confirm("确认要生成吗?","确认",function(t){t&&(abp.ui.setBusy($("#tb")),crudMS.options.service.createFrom(crudMS.depotId,crudMS.masterValue,e).done(function(e){abp.notify.info("已生成"+e+"个任务"),e>0&&crudMS.reload()}).always(function(){abp.ui.clearBusy($("#tb"))}))})}function i(){fmActivate.ZAZFingerActivex.spDeviceType=2,fmActivate.ZAZFingerActivex.spComPort=1,fmActivate.ZAZFingerActivex.spBaudRate=6,fmActivate.ZAZFingerActivex.CharLen=512,fmActivate.ZAZFingerActivex.FingerCode="",fmActivate.ZAZFingerActivex.TimeOut=7,fmActivate.ZAZFingerActivex.ZAZSetIMG(256,288);var e=fmActivate.ZAZFingerActivex.ZAZGetImgCode();if("0"==e){var t=fmActivate.ZAZFingerActivex.FingerCode.substring(0,512),i=fmActivate.ZAZFingerActivex.ZAZMatch(fmActivate.Finger.value,t);abp.notify.info("验证分值为: "+i),i>52?r("激活"):abp.notify.error("指纹验证错误")}}function a(){var e=$("#OperatePassword").val();return null==e||0===e.length?void abp.notify.error("请先设置用户操作认证密码"):e!=$("#Password").val()?void abp.notify.error("密码错误"):void r("密活")}function r(e){crudMS.options.service.activate(e).done.done(function(e){abp.notify.info("已激活"+e+"个任务"),e>0&&crudMS.reload()})}$(function(){crudMS.options.service=abp.services.app.whAffair,crudMS.masterField="#carryoutDate",crudMS.depotId=$("#depotId").val(),crudMS.parentField="#whAffairId",crudMS.parentValue=0,crudMS.options.editSon1Enabled=!1,abp.services.app.combo.getWorkerItems(crudMS.depotId).done(function(e){$("#workerId").combobox({data:e,valueField:"id",textField:"displayText"})}),$("#dd").datebox({onChange:e}),$("#dg").datagrid({onSelect:function(e,t){crudMS.parentValue=t.id,$("#dgSon1").datagrid({url:"WhAffairs/WorkersGridData/"+t.id})}}),$("#tb").children('a[name="activate"]').click(function(e){$("#dlgActivate").dialog("open"),$("#Password").val()=""}),$("#tb").children('a[name="createFrom"]').click(function(e){t()}),$("#dlgActivate-buttons").children('a[name="validFinger"]').click(function(e){i()}),$("#dlgActivate-buttons").children('a[name="validPassword"]').click(function(e){a()}),e()})})();