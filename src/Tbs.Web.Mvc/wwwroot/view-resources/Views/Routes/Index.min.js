(function(){function e(){crudMS.masterValue=$("#dd").datebox("getValue");var e=[];e.push({name:"depotId",value:crudMS.depotId}),e.push({name:"carryoutDate",value:crudMS.masterValue});var t=abp.utils.buildQueryString(e);$("#dg").datagrid({url:"Routes/GridData"+t}),crudMS.selectRow()}function t(){abp.message.confirm("确认要生成吗?","确认",function(e){e&&(abp.ui.setBusy($("#tb")),crudMS.options.service.createFromPre(crudMS.depotId,crudMS.masterValue).done(function(e){abp.notify.info("已生成"+e+"个任务"),e>0&&crudMS.reload()}).always(function(){abp.ui.clearBusy($("#tb"))}))})}function a(){var e=$("#fromDate").datebox("getValue");return""==e?void abp.notify.error("请先设置来源日期!"):crudMS.masterValue<e?void abp.notify.error("任务执行日期必须大于来源日期!"):void abp.message.confirm("确认要生成吗?","确认",function(t){t&&(abp.ui.setBusy($("#tb")),crudMS.options.service.createFrom(crudMS.depotId,crudMS.masterValue,e).done(function(e){abp.notify.info("已生成"+e+"个任务"),e>0&&crudMS.reload()}).always(function(){abp.ui.clearBusy($("#tb"))}))})}function i(){alert("to do")}function o(){fmActivate.ZAZFingerActivex.spDeviceType=2,fmActivate.ZAZFingerActivex.spComPort=1,fmActivate.ZAZFingerActivex.spBaudRate=6,fmActivate.ZAZFingerActivex.CharLen=512,fmActivate.ZAZFingerActivex.FingerCode="",fmActivate.ZAZFingerActivex.TimeOut=7,fmActivate.ZAZFingerActivex.ZAZSetIMG(256,288);var e=fmActivate.ZAZFingerActivex.ZAZGetImgCode();if("0"==e){var t=fmActivate.ZAZFingerActivex.FingerCode.substring(0,512),a=fmActivate.ZAZFingerActivex.ZAZMatch(fmActivate.Finger.value,t);abp.notify.info("验证分值为: "+a),a>52?d("激活"):abp.notify.error("指纹验证错误")}}function r(){var e=fmActivate.OperatePassword.value;return null==e||0===e.length?void abp.notify.error("请先设置用户操作认证密码"):e!=fmActivate.Password.value?void abp.notify.error("密码错误"):void d("密活")}function d(e){crudMS.options.service.activate(e).done.done(function(e){abp.notify.info("已激活"+e+"条线路"),e>0&&crudMS.reload()})}function n(){alert("to do")}var c;$(function(){crudMS.options.service=abp.services.app.route,crudMS.masterField="#carryoutDate",crudMS.depotId=$("#depotId").val(),crudMS.parentField="#routeId",crudMS.parentValue=0,$("#dd").datebox({onChange:e}),$("#dg").datagrid({onSelect:function(e,t){crudMS.parentValue=t.id,"安排"!==t.status&&(crudMS.options.editSon1Enabled=!1),t.routeTypeId!=c&&(c=t.routeTypeId,abp.services.app.combo.getRouteRoleItems(c).done(function(e){$("#routeRoleId").combobox({data:e,valueField:"id",textField:"name"})})),$("#dgSon1").datagrid({url:"Routes/WorkersGridData/"+t.id}),$("#dgSon2").datagrid({url:"Routes/TasksGridData/"+t.id})}}),$("#tb").children('a[name="activate"]').click(function(e){$("#dlgActivate").dialog("open"),fmActivate.OperatePassword.value=""}),$("#tb").children('a[name="createFromPre"]').click(function(e){t()}),$("#tb").children('a[name="createFrom"]').click(function(e){a()}),$("#tb").children('a[name="routeLog"]').click(function(e){i()}),$("#dlgActivate-buttons").children('a[name="validFinger"]').click(function(e){o()}),$("#dlgActivate-buttons").children('a[name="validPassword"]').click(function(e){r()}),$("#tbSon2").children('a[name="routeIdentify"]').click(function(e){n()}),abp.services.app.combo.getVehicleItems(crudMS.depotId).done(function(e){$("#vehicleId").combobox({data:e,valueField:"id",textField:"displayText"})}),abp.services.app.combo.getOutletItems(crudMS.depotId).done(function(e){$("#outletId").combobox({data:e,valueField:"id",textField:"displayText"})}),$.getComboItems("#taskTypeId","TaskType","Id","Cn","Name"),abp.services.app.combo.getWorkerItems(crudMS.depotId).done(function(e){$("#workerId").combobox({data:e,valueField:"id",textField:"displayText"})}),$.getComboItems("#routeTypeId","RouteType","Id","Name").done(function(t){e()})})})();