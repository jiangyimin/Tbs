(function(){function e(e,t,n){var r=$("#main-tab");r.tabs("exists",e)?r.tabs("select",e):r.tabs("add",{title:e,closable:!0,icon:n,content:a(t)})}function a(e){var a='<iframe scrolling="auto" frameborder="0" src="'+e+'" style="width:100%; height:99%"></iframe>';return a}function t(e,a){var t=$(e).data("tabTitle"),n=$("#main-tab"),r=n.tabs("tabs"),i=n.tabs("getTabIndex",n.tabs("getTab",t)),o=[];switch(a){case"tab-menu-refresh":var s=$(".tabs-panels .panel").eq(i).find("iframe");if(s){var l=s.attr("src");s.attr("src",l)}break;case"tab-menu-openFrame":var s=$(".tabs-panels .panel").eq(i).find("iframe");s&&window.open(s.attr("src"));break;case"tab-menu-close":o.push(t);break;case"tab-menu-closeleft":if(0==i)return void mfx.notify.warn("左边没有可关闭标签。");for(var c=0;c<i;c++){var u=$(r[c]).panel("options");u.closable&&o.push(u.title)}break;case"tab-menu-closeright":if(i==r.length-1)return void mfx.notify.warn("右边没有可关闭标签。");for(var c=i+1;c<r.length;c++){var u=$(r[c]).panel("options");u.closable&&o.push(u.title)}break;case"tab-menu-closeother":for(var c=0;c<r.length;c++)if(c!=i){var u=$(r[c]).panel("options");u.closable&&o.push(u.title)}break;case"tab-menu-closeall":for(var c=0;c<r.length;c++){var u=$(r[c]).panel("options");u.closable&&o.push(u.title)}}for(var c=0;c<o.length;c++)n.tabs("close",o[c])}function n(e){var a=[];return $.each(e,function(e,t){var n={};n.id=t.name,n.text=t.displayName,n.iconCls=t.icon,n.url=t.url,a.push(n)}),a}$(function(){$.getJSON("/Home/GetUserMenu",function(a){0!==a.result.length&&$.each(a.result,function(a,t){if(t.items.length>0){var r=!1;0===a&&(r=!0),$("#menu-accordion").accordion("add",{title:t.displayName,content:"<ul id='menu_tree_"+t.name+"'></ul>",iconCls:t.icon,selected:r});var i=n(t.items);$("#menu_tree_"+t.name).tree({data:i,onClick:function(a){e(a.text,a.url,a.iconCls)}})}})}),$("#main-tab").tabs({onContextMenu:function(e,a){e.preventDefault(),$("#tab-menu").menu("show",{left:e.pageX,top:e.pageY}).data("tabTitle",a)}}),$("#tab-menu").menu({onClick:function(e){t(this,e.id)}}),$("#changePassword").click(function(e){$("#dlg").dialog("open"),$("#fm").form("clear")}),$("#submit").click(function(e){if(e.preventDefault(),$("#fm").form("validate")){if($("#NewPassword").val()!=$("#NewPasswordAgain").val())return void abp.notify.warn("请核对两次密码输入正确!");var a=$("#dlg");abp.ui.setBusy(a),abp.services.app.user.changePassword($("#NewPassword").val()).done(function(){abp.notify.info("密码修改成功"),a.dialog("close")}).always(function(){abp.ui.clearBusy(a)})}})})})();