var crud=crud||{};(function(){var t,o=$("#datagrid"),e=$("#dlg"),n=$("#fm");crud.options={filter:"",readonly:!1,children:!1,parentId:0,name:"",title:"",toolbarItem:"reload,add,delete",sortName:"id",sortOrder:"asc",pageSize:20,pageList:[15,20,25,50,100,200],columns:[[]]},crud.startfunction=function(){},crud.endfunction=function(){},crud.reload=function(){o.datagrid("reload")},crud.addNew=function(){return crud.options.children&&0===crud.options.parentId?void abp.notify.error("请先选择上级记录"):(e.dialog("open").dialog("setTitle","增加"),n.form("clear"),$("#id").attr("value","0"),crud.options.parentId>0&&$("#"+crud.options.parentField).combobox("setValue",crud.options.parentId),void(t="/CreateEntity"))},crud.deletes=function(){var e=o.datagrid("getChecked");if(0===e.length)return void abp.notify.warn("请先选中要删除的行。");var n=[];e.forEach(function(t,o,e){n.push(t.id)}),abp.message.confirm("确认要删除所有选中的行?","请确认",function(o){o&&(t="/DeleteEntities",crud.sendAjax({ids:n}))})},crud.edit=function(r){var d=o.datagrid("getRows")[r];e.dialog("open").dialog("setTitle","编辑"),n.form("load",d),t="/UpdateEntity"},crud.delete=function(e){var n=o.datagrid("getRows")[e];n&&abp.message.confirm("确认要删除此记录吗?","请确认",function(o){o&&(t="/DeleteEntity",crud.sendAjax({id:n.id}))})},crud.cancel=function(){e.dialog("close")},crud.save=function(){if(n.form("validate")){var t=new FormData(document.getElementById("fm"));abp.ui.setBusy(e,crud.sendFdAjax(t))}},crud.sendAjax=function(n){abp.ajax({contentType:"text/xml",url:crud.options.name+t,data:n,success:function(t){abp.notify.info(t.content),e.dialog("close"),o.datagrid("reload")}})},crud.sendFdAjax=function(n){return abp.ajax({contentType:!1,processData:!1,url:crud.options.name+t,data:n,success:function(t){abp.notify.info(t.content),e.dialog("close"),o.datagrid("reload")}})},crud.operator=function(t,o,e){var n='<a href="javascript:void(0)" class="easyui-linkbutton" onclick="crud.edit('+e+')">编辑</a>';return n+="<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>",n=n+'<a href="javascript:void(0)" class="easyui-linkbutton" onclick="crud.delete('+e+')">删除</a>'},$(function(){crud.startfunction();var t=[];crud.options.toolbarItem.indexOf("reload")>=0&&t.push({text:"刷新",iconCls:"icon-reload",handler:crud.reload}),crud.options.readonly===!1&&crud.options.toolbarItem.indexOf("add")>=0&&t.push({text:"增加",iconCls:"icon-add",handler:crud.addNew}),crud.options.readonly===!1&&crud.options.toolbarItem.indexOf("delete")>=0&&(t.push("-"),t.push({text:"批量删除",iconCls:"icon-remove",handler:crud.deletes})),crud.options.readonly===!1&&(crud.options.columns[0].unshift({field:"ck",checkbox:!0}),crud.options.columns[0].push({field:"operator",title:"操作",width:80,align:"center",formatter:crud.operator}));var n="";crud.options.children===!1&&(n=crud.options.name+"/GridPagedData/"+crud.options.filter),o.datagrid({url:n,title:crud.options.title+"列表",toolbar:t,fit:!0,fitColumns:!0,columns:crud.options.columns,striped:!0,rownumbers:!0,checkOnSelect:!1,sortName:crud.options.sortName,sortOrder:crud.options.sortOrder,pagination:!0,pageSize:crud.options.pageSize,pageList:crud.options.pageList,showFooter:!1}),e.dialog({buttons:[{text:"保存",iconCls:"icon-save",handler:crud.save},{text:"取消",iconCls:"icon-cancel",handler:crud.cancel}]}),crud.endfunction()})})();