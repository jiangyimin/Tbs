var crudMS=crudMS||{};(function(){crudMS.options={dgParent:"#dg",dlgParent:"#dlg",fmParent:"#fm",dgSon1:"#dgSon1",dlgSon1:"#dlgSon1",fmSon1:"#fmSon1",dgSon2:"#dgSon2",dlgSon2:"#dlgSon2",fmSon2:"#fmSon2",readonly:!1};var o=$(crudMS.options.dgParent),n=$(crudMS.options.dlgParent),e=$(crudMS.options.fmParent);crudMS.reload=function(){o.datagrid("reload"),crudMS.selectRow()},crudMS.addNew=function(){n.dialog("open").dialog("setTitle","增加"),e.form("clear"),$("#id").attr("value","0"),$("#depotId").attr("value",crudMS.depotId),crudMS.masterField&&$(crudMS.masterField).attr("value",crudMS.masterValue)},crudMS.deletes=function(){var n=o.datagrid("getChecked");if(0===n.length)return void abp.notify.warn("请先选中要删除的行。");var e=[];n.forEach(function(o,n,a){e.push(o.id)}),abp.message.confirm("确认要删除所有选中的行?","请确认",function(n){n&&crudMS.options.service.deletes(e).done(function(){abp.notify.info("批量删除操作成功"),o.datagrid("reload"),crudMS.selectRow()})})},crudMS.edit=function(a){var t=o.datagrid("getRows")[a];n.dialog("open").dialog("setTitle","编辑"),e.form("load",t)},crudMS.delete=function(n){var e=o.datagrid("getRows")[n];e&&abp.message.confirm("确认要删除此记录吗?","请确认",function(n){n&&crudMS.options.service.delete(e.id).done(function(){abp.notify.info("删除操作成功"),o.datagrid("reload"),crudMS.selectRow()})})},crudMS.save=function(){if(e.form("validate")){var a=e.serializeFormToObject();abp.ui.setBusy(n);var t;t="增加"===n.panel("options").title?crudMS.options.service.insert(a):crudMS.options.service.update(a),t.done(function(){abp.notify.info(n.panel("options").title+"操作成功"),n.dialog("close"),o.datagrid("reload"),crudMS.selectRow()}).always(function(){abp.ui.clearBusy(n)})}},crudMS.operator=function(o,n,e){if(crudMS.options.readonly!==!0){var a='<a href="javascript:void(0)" class="easyui-linkbutton" onclick="crudMS.edit('+e+')">编辑</a>';return a+="<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>",a=a+'<a href="javascript:void(0)" class="easyui-linkbutton" onclick="crudMS.delete('+e+')">删除</a>'}},crudMS.selectRow=function(){o.datagrid("getRows").length>0&&o.datagrid("selectRow",0),crudMS.parentValue=0};var a=$(crudMS.options.dgSon1),t=$(crudMS.options.dlgSon1),i=$(crudMS.options.fmSon1);crudMS.operatorSon1=function(o,n,e){if(crudMS.options.readonly!==!0&&crudMS.options.editSon1Enabled!==!1){var a='<a href="javascript:void(0)" class="easyui-linkbutton" onclick="crudMS.editSon1('+e+')">编辑</a>';return a+="<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>",a=a+'<a href="javascript:void(0)" class="easyui-linkbutton" onclick="crudMS.deleteSon1('+e+')">删除</a>'}},crudMS.addNewSon1=function(){return 0===crudMS.parentValue?void abp.notify.error("请先选择上级记录"):(t.dialog("open").dialog("setTitle","增加"),i.form("clear"),$("#idSon1").attr("value","0"),void(crudMS.parentField&&$(crudMS.parentField).attr("value",crudMS.parentValue)))},crudMS.deletesSon1=function(){var o=a.datagrid("getChecked");if(0===o.length)return void abp.notify.warn("请先选中要删除的行。");var n=[];o.forEach(function(o,e,a){n.push(o.id)}),abp.message.confirm("确认要删除所有选中的行?","请确认",function(o){o&&crudMS.options.service.deletesSon(n).done(function(){abp.notify.info("批量删除操作成功"),a.datagrid("reload")})})},crudMS.editSon1=function(o){var n=a.datagrid("getRows")[o];t.dialog("open").dialog("setTitle","编辑"),i.form("load",n)},crudMS.deleteSon1=function(o){var n=a.datagrid("getRows")[o];n&&abp.message.confirm("确认要删除此记录吗?","请确认",function(o){o&&crudMS.options.service.deleteSon(n.id).done(function(){abp.notify.info("删除操作成功"),a.datagrid("reload")})})},crudMS.saveSon1=function(){if(i.form("validate")){var o=i.serializeFormToObject();abp.ui.setBusy(t);var n;n="增加"===t.panel("options").title?crudMS.options.service.insertSon(o):crudMS.options.service.updateSon(o),n.done(function(){abp.notify.info(t.panel("options").title+"操作成功"),t.dialog("close"),a.datagrid("reload")}).always(function(){abp.ui.clearBusy(t)})}};var d=$(crudMS.options.dgSon2),r=$(crudMS.options.dlgSon2),c=$(crudMS.options.fmSon2);crudMS.operatorSon2=function(o,n,e){if(crudMS.options.readonly!==!0&&crudMS.options.editSon2Enabled!==!1){var a='<a href="javascript:void(0)" class="easyui-linkbutton" onclick="crudMS.editSon2('+e+')">编辑</a>';return a+="<span>&nbsp;&nbsp;&nbsp;&nbsp;</span>",a=a+'<a href="javascript:void(0)" class="easyui-linkbutton" onclick="crudMS.deleteSon2('+e+')">删除</a>'}},crudMS.addNewSon2=function(){return 0===crudMS.parentValue?void abp.notify.error("请先选择上级记录"):(r.dialog("open").dialog("setTitle","增加"),c.form("clear"),$("#idSon2").attr("value","0"),void(crudMS.parentField&&$(crudMS.parentField+"2").attr("value",crudMS.parentValue)))},crudMS.deletesSon2=function(){var o=d.datagrid("getChecked");if(0===o.length)return void abp.notify.warn("请先选中要删除的行。");var n=[];o.forEach(function(o,e,a){n.push(o.id)}),abp.message.confirm("确认要删除所有选中的行?","请确认",function(o){o&&crudMS.options.service.deletesSon2(n).done(function(){abp.notify.info("批量删除操作成功"),d.datagrid("reload")})})},crudMS.editSon2=function(o){var n=d.datagrid("getRows")[o];r.dialog("open").dialog("setTitle","编辑"),c.form("load",n)},crudMS.deleteSon2=function(o){var n=d.datagrid("getRows")[o];n&&abp.message.confirm("确认要删除此记录吗?","请确认",function(o){o&&crudMS.options.service.deleteSon2(n.id).done(function(){abp.notify.info("删除操作成功"),d.datagrid("reload")})})},crudMS.saveSon2=function(){if(c.form("validate")){var o=c.serializeFormToObject();abp.ui.setBusy(r);var n;n="增加"===r.panel("options").title?crudMS.options.service.insertSon2(o):crudMS.options.service.updateSon2(o),n.done(function(){abp.notify.info(t.panel("options").title+"操作成功"),r.dialog("close"),d.datagrid("reload")}).always(function(){abp.ui.clearBusy(r)})}}})();